"use strict";(self.webpackChunkglueple_user=self.webpackChunkglueple_user||[]).push([[4304],{94304:(e,a,t)=>{t.r(a),t.d(a,{default:()=>A});var n=t(65043),l=t(29829),d=t(49985),o=t(22166),s=t(70579);const i=e=>{const{getAdvanceRequestPending:a}=(0,o.d4)((e=>null===e||void 0===e?void 0:e.payroll)),{toggleOpenCloseModal:t,advanceRequestData:i,currentPage:r,setCurrentPage:c}=e,v=(0,n.useMemo)((()=>({sn:(e,a)=>(0,s.jsx)("span",{children:a+1}),start_date:(e,a)=>(0,s.jsx)("span",{children:(0,d.N_)(null===e||void 0===e?void 0:e.start_date)}),end_date:(e,a)=>(0,s.jsx)("span",{children:(0,d.N_)(null===e||void 0===e?void 0:e.end_date)}),action:e=>(0,s.jsxs)("div",{className:"btn-group actionDrp",children:[(0,s.jsx)("button",{type:"button",className:"btn dropdown-toggle-split","data-bs-toggle":"dropdown","aria-expanded":"false",children:(0,s.jsx)("i",{className:"bi bi-three-dots-vertical"})}),(0,s.jsx)("ul",{className:"dropdown-menu",children:(0,s.jsx)("li",{children:(0,s.jsx)("span",{className:"dropdown-item",onClick:()=>t(e,"view"),children:"View Details"})})})]})})),[i,r]);return(0,s.jsx)("div",{children:(0,s.jsx)(l.Ak,{data:null===i||void 0===i?void 0:i.data,fields:[{key:"sn",label:"S.N"},{key:"advance_type_name",label:"Loan Type"},{key:"amount",label:"Loan Amount"},{key:"tenure_duration",label:"EMI Duration"},{key:"start_date",label:"Effective Date"},{key:"end_date",label:"End Date"},{key:"action",label:"Action"}],isLoading:a,pagination:!0,currentPage:r,setCurrentPage:e=>c(e),totalPages:null===i||void 0===i?void 0:i.totalPages,isHeader:!1,tableStyle:{padding:"0px",boxShadow:"none"},scopedSlots:v})})},r=e=>{const{getAdvanceApprovalPending:a}=(0,o.d4)((e=>null===e||void 0===e?void 0:e.payroll)),{advanceApprovalData:t,currentPage:i,setCurrentPage:r,toggleApprovalRejectModal:c}=e,v=(0,n.useMemo)((()=>({sn:(e,a)=>(0,s.jsx)("span",{children:a+1}),start_date:(e,a)=>(0,s.jsx)("span",{children:(0,d.N_)(null===e||void 0===e?void 0:e.start_date)}),end_date:(e,a)=>(0,s.jsx)("span",{children:(0,d.N_)(null===e||void 0===e?void 0:e.end_date)}),action:e=>(0,s.jsxs)("div",{className:"btn-group actionDrp",children:[(0,s.jsx)("button",{type:"button",className:"btn dropdown-toggle-split","data-bs-toggle":"dropdown","aria-expanded":"false",children:(0,s.jsx)("i",{className:"bi bi-three-dots-vertical"})}),(0,s.jsx)("ul",{className:"dropdown-menu",children:(0,s.jsx)("li",{children:(0,s.jsx)("span",{className:"dropdown-item",onClick:()=>c(null===e||void 0===e?void 0:e._id),children:"Approve & Reject"})})})]})})),[t,i]);return(0,s.jsx)("div",{children:(0,s.jsx)(l.Ak,{data:null===t||void 0===t?void 0:t.data,fields:[{key:"sn",label:"S.N"},{key:"advance_type_name",label:"Loan Type"},{key:"amount",label:"Loan Amount"},{key:"tenure_duration",label:"EMI Duration"},{key:"start_date",label:"Effective Date"},{key:"end_date",label:"End Date"},{key:"action",label:"Action"}],isLoading:a,pagination:!0,currentPage:i,setCurrentPage:e=>r(e),totalPages:null===t||void 0===t?void 0:t.totalPages,isHeader:!1,tableStyle:{padding:"0px",boxShadow:"none"},scopedSlots:v})})};var c=t(85831),v=t(86178),u=t.n(v),p=t(45531),m=t(56462),x=t(99708),g=t(90607),h=t(26181),j=t(80728);const f=e=>{const{t:a}=(0,g.K)(),{toggleOpenClose:t,isOpen:l,filteredDropdownData:o,handleApplyAdvanceRequest:i,selectedLoanData:r,loading:v}=e,[f,b]=(0,n.useState)({loanType:null,amount:"",emiDuration:null,startDate:"",endDate:""}),[D,y]=(0,n.useState)(""),[A,_]=(0,n.useState)([]),N=(e,a)=>{var t;const n=a||(null===(t=e.target)||void 0===t?void 0:t.name),{value:l,type:d,checked:o}=null!==e&&void 0!==e&&e.target?e.target:{value:e};"startDate"===n&&(_([]),k(l)),"emiDuration"===n&&(b((e=>({...e,startDate:"",endDate:""}))),_([])),"amount"===n&&(b((e=>({...e,emiDuration:null,startDate:"",endDate:""}))),_([])),b((e=>({...e,[n]:"checkbox"===d?o:l}))),y((e=>({...e,[n]:void 0})))},k=e=>{const a=u()(e).add(Number(f.emiDuration.category_value)-1,"M").format("YYYY-MM-DD");b((e=>({...e,endDate:a}))),w(e)},w=e=>{var a;let t=parseFloat(null===f||void 0===f?void 0:f.amount)||0,n=parseInt(null===f||void 0===f||null===(a=f.emiDuration)||void 0===a?void 0:a.category_value)||1,l=(parseFloat(null===f||void 0===f?void 0:f.interestRate)||0)/12/100,d=0;d=l>0?(t*l*Math.pow(1+l,n)/(Math.pow(1+l,n)-1)).toFixed(2):(t/n).toFixed(2);let o=[],s=u()(e).format("YYYY-MM-DD");for(let i=1;i<=n;i++)o.push({installment:i,payment_date:s,emi_amount:d}),s=u()(s).add(1,"month").format("YYYY-MM-DD");_(o)};return(0,n.useEffect)((()=>{r&&(_(null===r||void 0===r?void 0:r.installments),b({employee:{label:null===r||void 0===r?void 0:r.name,value:null===r||void 0===r?void 0:r.value},loanType:{label:null===r||void 0===r?void 0:r.loan_type_name,value:null===r||void 0===r?void 0:r.loan_type_value},amount:null===r||void 0===r?void 0:r.amount,emiDuration:{value:null===r||void 0===r?void 0:r.tenure_duration,label:""},startDate:null===r||void 0===r?void 0:r.start_date,endDate:null===r||void 0===r?void 0:r.end_date}))}),[r]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"offcanvas offcanvas-end creatNewTicketOff "+(l?"show":""),tabIndex:-1,style:{visibility:l?"visible":"hidden",width:"800px"},children:[(0,s.jsxs)("div",{className:"offcanvas-header",children:[(0,s.jsx)("h5",{className:"offcanvas-title  fs-5 fw-bold text-primary",children:" Apply Advance"}),(0,s.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"offcanvas","aria-label":"Close",onClick:()=>t()})]}),(0,s.jsx)("div",{className:"offcanvas-body",children:(0,s.jsx)("div",{className:"formPanel",children:(0,s.jsxs)("div",{className:"row",children:[(0,s.jsx)("div",{className:"col-md-6",children:(0,s.jsxs)("div",{className:"form-group mb-2",children:[(0,s.jsx)(p.JU,{text:a("labels.loanType"),required:!0}),(0,s.jsx)(m.A,{data:null===o||void 0===o?void 0:o.loan_type,placeholder:a("placeholders.loanType"),value:(null===f||void 0===f?void 0:f.loanType)||"",handleChange:e=>N(e,"loanType"),name:"loanType"})]})}),(0,s.jsx)("div",{className:"col-md-6",children:(0,s.jsxs)("div",{className:"form-group mb-2",children:[(0,s.jsx)(p.JU,{text:a("labels.amount"),required:!0}),(0,s.jsx)(p.pd,{type:"number",placeholder:a("placeholders.amount"),value:null===f||void 0===f?void 0:f.amount,name:"amount",onChange:e=>N(e)}),(null===D||void 0===D?void 0:D.amount)&&(0,s.jsx)(c.eo,{text:D.amount})]})}),(0,s.jsxs)("div",{className:"col-md-6",children:[(0,s.jsxs)("div",{className:"form-group mb-2",children:[(0,s.jsx)(p.JU,{text:a("labels.emiDuration"),required:!0}),(0,s.jsx)(m.A,{data:null===o||void 0===o?void 0:o.emi_duration,placeholder:a("placeholders.emiDuration"),value:(null===f||void 0===f?void 0:f.emiDuration)||"",handleChange:e=>N(e,"emiDuration"),name:"emiDuration"})]}),(null===D||void 0===D?void 0:D.emiDuration)&&(0,s.jsx)(c.eo,{text:D.emiDuration})]}),(0,s.jsxs)("div",{className:"col-md-6",children:[(0,s.jsxs)("div",{className:"form-group mb-2",children:[(0,s.jsx)(p.JU,{text:a("labels.startDate"),required:!0}),(0,s.jsx)(p.pd,{type:"date",value:(0,d.N_)(null===f||void 0===f?void 0:f.startDate,"YYYY-MM-DD"),isDisabled:null===f||void 0===f||!f.emiDuration,name:"startDate",onChange:e=>N(e)})]}),(null===D||void 0===D?void 0:D.startDate)&&(0,s.jsx)(c.eo,{text:D.startDate})]}),(0,s.jsx)("div",{className:"col-md-6",children:(0,s.jsxs)("div",{className:"form-group mb-2",children:[(0,s.jsx)(p.JU,{text:a("labels.endDate"),required:!0}),(0,s.jsx)(p.pd,{type:"date",value:(0,d.N_)(null===f||void 0===f?void 0:f.endDate,"YYYY-MM-DD"),isDisabled:!0,name:"endDate",onChange:e=>N(e)}),(null===D||void 0===D?void 0:D.endDate)&&(0,s.jsx)(c.eo,{text:D.endDate})]})}),(0,s.jsx)("hr",{}),A&&(null===A||void 0===A?void 0:A.length)>0&&(0,s.jsxs)("div",{className:"col-12",children:[(0,s.jsxs)("div",{className:"card text-center p-1 m-o",style:{backgroundColor:"#3c82e9",color:"white"},children:[" ",(0,s.jsx)("h6",{children:"Pending Installment "})]}),(0,s.jsx)(x.A,{installmentData:A,setInstallmentData:_,loanData:f})]})]})})}),(0,s.jsx)("div",{className:"offcanvas-footer",children:(0,s.jsx)("div",{className:"d-flex align-items-center justify-content-end gap-3",children:(0,s.jsx)(c.Sv,{text:"Add",classNames:"btn btn-org-gradient",handleClick:()=>(async()=>{const e=await(0,h.i6)(j.my,f);if(e.isValid){const{loanType:e,amount:a,emiDuration:t,startDate:n,endDate:l}=f;y({});const d={loan_type:null===e||void 0===e?void 0:e.value,amount:a||0,tenure_duration:null===t||void 0===t?void 0:t.value,start_date:n,end_date:l,installments:A};i(d)}else y(e.errors)})(),isLoading:v})})})]}),l&&(0,s.jsx)("div",{className:"modal-backdrop fade show"})]})};var b=t(94174),D=t(52027),y=(t(35685),t(77273));const A=()=>{const e=(0,o.wA)(),[a,t]=(0,n.useState)(""),[v,u]=(0,n.useState)(!1),[p,m]=(0,n.useState)(""),[x,g]=(0,n.useState)(1),[h,j]=(0,n.useState)(1),[A,_]=(0,n.useState)(""),[N,k]=(0,n.useState)(""),[w,R]=(0,n.useState)(""),[C,P]=(0,n.useState)(""),[S,E]=(0,n.useState)(""),{getFilteredDropdownDataError:M,getFilteredDropdownDataRes:q,getFilteredDropdownDataPending:Y}=(0,o.d4)((e=>e.dropdownMaster)),{applyAdvancePending:F,applyAdvanceRes:L,applyAdvanceError:T,getAdvanceRequestPending:V,getAdvanceRequestRes:I,getAdvanceRequestError:O,getAdvanceApprovalRes:H,getAdvanceApprovalError:J,getAdvanceApprovalPending:X,approvalRejectAdvanceRes:$,approvalRejectAdvanceError:U,approvalRejectAdvancePending:B}=(0,o.d4)((e=>e.payroll));(0,n.useEffect)((()=>{K()}),[]);const K=()=>{let a={category:["loan_type","emi_duration"]};e(b.dk.getFilteredDropdownDataRequest(a))};(0,n.useEffect)((()=>{if(!Y){if(M)return;if(q&&200===(null===q||void 0===q?void 0:q.code)){var e;const a=(0,d.Ib)(null===q||void 0===q||null===(e=q.data)||void 0===e?void 0:e.data);m(a)}}}),[q,M,Y]);const Q=[{name:"My Request",onClickFun:e=>z(e),id:"advance_request"},{name:"Advance Approval",onClickFun:e=>z(e),id:"advance_approval"}],z=e=>{t(e)},G=e=>{u(!v)};(0,n.useEffect)((()=>{if(!F){if(T)return void e(b.Vg.handleClearPayrollStore("HANDLE_CLEAR_APPLY_ADVANCE_STORE"));L&&200===(null===L||void 0===L?void 0:L.code)&&(G(),e(b.Vg.handleClearPayrollStore("HANDLE_CLEAR_APPLY_ADVANCE_STORE")),W())}}),[L,T,F]),(0,n.useEffect)((()=>{W()}),[x]);const W=()=>{const a={page:x,limit:null===D.X$||void 0===D.X$?void 0:D.X$.limit};e(b.Vg.getAdvanceRequestRequest(a))};(0,n.useEffect)((()=>{if(!V){if(O)return;I&&200===(null===I||void 0===I?void 0:I.code)&&_(null===I||void 0===I?void 0:I.data)}}),[I,O,V]),(0,n.useEffect)((()=>{Z()}),[h]);const Z=()=>{const a={page:h,limit:null===D.X$||void 0===D.X$?void 0:D.X$.limit};e(b.Vg.getAdvanceApprovalRequest(a))};(0,n.useEffect)((()=>{if(!X){if(J)return;H&&200===(null===H||void 0===H?void 0:H.code)&&k(null===H||void 0===H?void 0:H.data)}}),[H,J,X]);const ee=e=>{e&&P(e),R(!w)};return(0,n.useEffect)((()=>{if(!B){if(U)return;$&&200===(null===$||void 0===$?void 0:$.code)&&(ee(),W(),Z())}}),[$,U,B]),(0,s.jsxs)("div",{className:"cardBox",children:[(0,s.jsxs)("div",{className:"tab-pane fade show active",id:"receivedFeedback",children:[(0,s.jsxs)("div",{className:"cardHead d-flex justify-content-between",children:[(0,s.jsxs)("div",{className:"d-flex align-items-center",children:[(0,s.jsx)("img",{src:"images/kpi-guidline.svg",alt:"",width:40,className:"me-2 fw-bold"}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)("h3",{children:"Advance "})})]}),(0,s.jsx)(c.Sv,{text:"Apply Advance",handleClick:()=>G(),classNames:"btn btn-primary",slug:"apply_advance"})]}),(0,s.jsx)(l.QE,{tabs:Q,type:"rayRuns"}),(0,s.jsxs)("div",{className:"tab-content mykpiMain",children:[(0,s.jsx)("div",{className:"tab-pane fade active show",id:"advance_request",children:(0,s.jsx)(i,{currentPage:x,setCurrentPage:g,advanceRequestData:A})}),(0,s.jsx)("div",{className:"tab-pane fade",id:"advance_approval",children:(0,s.jsx)(r,{currentPage:h,setCurrentPage:j,advanceApprovalData:N,toggleApprovalRejectModal:ee})})]})]}),v&&(0,s.jsx)(f,{isOpen:v,toggleOpenClose:G,filteredDropdownData:p,handleApplyAdvanceRequest:a=>{e(b.Vg.applyAdvanceRequest(a))},loading:F}),w&&(0,s.jsx)(y.A,{title:"Advance Approve Reject",onApproveReject:a=>{if(a){const t={_id:C,action_type:a,comment:S};e(null===b.Vg||void 0===b.Vg?void 0:b.Vg.approvalRejectAdvanceRequest(t))}else ee()},isShow:w,setComment:E,comment:S})]})}},99708:(e,a,t)=>{t.d(a,{A:()=>s});var n=t(65043),l=t(29829),d=t(45531),o=t(70579);const s=e=>{const{installmentData:a,setInstallmentData:t,loanData:s}=e,i=(0,n.useMemo)((()=>({amount:(e,n)=>(0,o.jsx)("span",{children:(0,o.jsx)(d.pd,{type:"number",className:"form-control border border-black text-center",id:"instl_amt",placeholder:"Installment Amount",onChange:e=>((e,n)=>{let l,d=a;d[n].amount=parseFloat(e).toFixed(2);let o=0;d.forEach(((e,a)=>(o+=parseFloat(e.amount),a===n?(l=parseFloat(null===s||void 0===s?void 0:s.amount)-o>=0?parseFloat(null===s||void 0===s?void 0:s.amount)-o:0,l/=(d.length-1-n).toFixed(2)):a>n&&(e.amount=JSON.stringify(l)),e))),t(d)})(e.target.value,n),value:parseFloat(null===e||void 0===e?void 0:e.amount)})})})),[a]);return(0,o.jsx)(n.Fragment,{children:(0,o.jsx)("div",{className:"text-center",children:(0,o.jsx)(l.Ak,{data:a,fields:[{key:"installment",label:"Installment"},{key:"payment_date",label:"Payment Date"},{key:"emi_amount",label:"Amount"}],pagination:!0,isHeader:!1,tableStyle:{padding:"0px",boxShadow:"none",marginTop:"0px !important"},scopedSlots:i})})})}}}]);
//# sourceMappingURL=4304.ab7e0ba2.chunk.js.map